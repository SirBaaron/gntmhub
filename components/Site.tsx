import Head from 'next/head';
import {ReactNode} from 'react';
import {useUser} from '@auth0/nextjs-auth0';
import {useCandidateStore, useQuestionStore, useUserStore} from '../util/store';
import {price} from '../util/market';
import Link from 'next/link';

function Navigation() {
    const [{
        user: authUser,
        isLoading: userLoading
    }, storeLoading, user, questionLoading] = [useUser(), useCandidateStore(store => store.loading), useUserStore(store => store.user), useQuestionStore(store => store.loading)];
    useUserStore(store => store.load());
    const loading = userLoading || storeLoading || questionLoading;

    return <>
        <div>
            <div className="flex">
                <div className="font-display text-2xl font-bold">GNTMHUB</div>
                {loading && <img src="/loader.svg" className="w-7 mt-0.5 opacity-50"/>}

            </div>
            <div className="text-lg flex flex-col space-y-2 mt-6">
                <a><Link href="/app">Kandidatinnen</Link></a>
                <a><Link href="/app/questions">Fragen</Link></a>
            </div>
        </div>
        {!!user && <div>
          <div className="flex space-x-2">
            <img src={authUser?.picture!} alt={authUser?.name!} className="rounded-3xl w-8 h-8 overflow-hidden"/>
            <div className="flex flex-col leading-4">
              <div>{authUser?.name!}</div>
              <div className="text-primary font-bold">{price(user.points as unknown as number)}</div>
            </div>
          </div>
        </div>}
    </>;
}

export function Site(props: { children: ReactNode }) {

    return <><Head>
        <title>GNTMHUB</title>
        <meta name="description" content="Generated by create next app"/>
        <link rel="icon" href="/favicon.ico"/>
        <link rel="preconnect" href="https://fonts.googleapis.com"/>
        <link rel="preconnect" href="https://fonts.gstatic.com"/>
    </Head>
        <div className="flex flex-col px-4 lg:px-0 lg:flex-row mx-auto max-w-[800px] lg:mx-0 lg:max-w-none h-screen text-dark">
            <div className="bg-light p-6 flex flex-col justify-between flex-shrink-0 my-4 lg:my-0">
                <Navigation/>
            </div>
            <div className="w-full h-full relative overflow-y-hidden">
                <div className="h-full overflow-y-auto lg:p-6">
                    {props.children}
                </div>
            </div>
        </div>
    </>;
}